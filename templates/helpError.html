<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Help Error - База знаний ошибок</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">

</head>
<body>
    <div class="container">
        <header class="d-flex justify-content-center py-3">
            <h2>База знаний ошибок</h2>
        </header>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="searchError" class="form-label"><b>Поиск ошибки:</b></label>
                <input type="text" class="form-control" id="searchError" placeholder="Введите название ошибки...">
                <div id="suggestions" class="list-group"></div> <!-- Suggestion box as Bootstrap list-group -->
            </div>
        </div>
        <div>
            <label for="errorSelect">Выберите ошибку:</label>
            <select id="errorSelect">
                <option value="">--Выберите ошибку--</option>
            </select>
        </div>
    </div>
    <div id="errorInfo" class="p-4">
        <h3>Информация об ошибке</h3>
        <p>Выберите ошибку из списка или найдите через поиск, чтобы увидеть подробную информацию.</p>
        <hr class="mb-4">
        <h5 class="mb-3"><b>Ошибка:</b> <span id="errorName"></span></h5>
        <div class="text-center mb-3">
            <img src="" alt="Изображение ошибки" id="errorImage" class="error-image" style="display:none;">
        </div>
        <h5 class="mb-3"><b>Решение проблемы:</b></h5>
        <p id="errorSolution"></p>
    </div>

    <div id="loginForm">
        <h2>Вход</h2>
        <input type="text" id="username" placeholder="Логин" />
        <input type="password" id="password" placeholder="Пароль" />
        <button id="loginButton">Войти</button>
    </div>
    <div id="adminControls" style="display: none;">
        <div id="errorMessage" style="color: red; display: none;"></div> <!-- Элемент для отображения ошибок -->

        <h3>Создать новую ошибку</h3>
        <form id="createErrorForm" enctype="multipart/form-data"> <!-- Добавлено enctype для загрузки файлов -->
            <input type="text" name="errorName" placeholder="Название ошибки" required>
            <input type="file" name="errorImageFile" accept="image/*" alt="Формат img или png" required> <!-- Поле для загрузки изображения -->
            <textarea name="errorSolution" placeholder="Решение проблемы" required></textarea>
            <button type="submit">Создать ошибку</button>
        </form>

        <h3>Обновить существующую ошибку</h3>
        <form id="updateErrorForm">
            <input type="hidden" name="errorId" required>
            <input type="text" name="errorName" placeholder="Новое название ошибки" required>
            <input type="file" name="errorImageFile" accept="image/*" required> <!-- Поле для загрузки изображения -->
            <textarea name="errorSolution" placeholder="Новое решение проблемы" required></textarea>
            <button type="submit">Обновить ошибку</button>
        </form>

        <button id="deleteErrorButton">Удалить ошибку</button>
        <script>
            document.getElementById('deleteErrorButton').addEventListener('click', function() {
                // Логика для удаления ошибки
                const errorId = document.querySelector('input[name="errorId"]').value;
                if (errorId) {
                    fetch(`/api/errors/${errorId}`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if (response.ok) {
                            alert('Ошибка успешно удалена');
                            location.reload(); // Обновляем страницу после удаления
                        } else {
                            alert('Ошибка при удалении');
                        }
                    });
                } else {
                    alert('Пожалуйста, выберите ошибку для удаления');
                }
            });
        </script>

        
        <ul id="errorList"></ul> <!-- Добавлен элемент для отображения списка ошибок -->
    </div>
    <footer class="py-3 my-4 border-top">
        <p class="text-center text-muted">© 2024 Goga, Inc</p>
    </footer>
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginButton = document.getElementById('loginButton');
            const adminControls = document.getElementById('adminControls');
            loginButton.addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username === 'admin' && password === 'admin') {
                   adminControls.style.display = 'block'; // Показываем элементы управления администратором
                    document.getElementById('loginForm').style.display = 'none'; // Скрываем форму входа
                } else {
                    alert('Неверный логин или пароль');
                }
            });
        });
        // JavaScript to handle API calls and UI updates
        document.addEventListener('DOMContentLoaded', function() {
            const errorSelect = document.getElementById('errorSelect');
            const errorList = document.getElementById('errorList'); // Элемент для отображения списка ошибок
            const searchError = document.getElementById('searchError');
            const suggestions = document.getElementById('suggestions'); // Элемент для отображения предложений
            let errors = {}; // Объект для хранения ошибок

            // Fetch and display errors
            function fetchErrors() { // Функция для получения ошибок
                fetch('http://127.0.0.1:5000/api/errors') // Запрос к API для получения ошибок
                    .then(response => response.json())
                    .then(data => {
                        errorList.innerHTML = '';
                        errors = data.reduce((acc, error) => {
                            acc[error.id] = error; // Сохраняем ошибки в объект для быстрого доступа
                            const li = document.createElement('li');
                            li.textContent = error.name;
                            li.onclick = function() {
                                errorSelect.value = error.id; // Set selected error ID
                                document.querySelector('input[name="errorId"]').value = error.id; // Set hidden input for update
                                document.querySelector('input[name="errorName"]').value = error.name; // Set name for update
                                document.querySelector('input[name="errorImage"]').value = error.image; // Set image for update
                                document.querySelector('textarea[name="errorSolution"]').value = error.solution; // Set solution for update
                            };
                            errorList.appendChild(li);
                            return acc;
                        }, {});
                    });
            }

            // Fetch suggestions based on input
            searchError.addEventListener('input', function() { // Обработчик события ввода
                const searchValue = this.value.toLowerCase();
                suggestions.innerHTML = ''; // Очистить предыдущие предложения
                if (searchValue) {
                    const matchingErrors = Object.keys(errors).filter(key => 
                        errors[key].name.toLowerCase().includes(searchValue)
                    );
                    if (matchingErrors.length > 0) {
                        suggestions.style.display = 'block'; // Показать предложения
                        matchingErrors.forEach(key => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.className = 'suggestion-item';
                            suggestionItem.textContent = errors[key].name; // Отобразить имя вместо ключа
                            suggestionItem.onclick = function() {
                                searchError.value = errors[key].name; // Установить значение ввода на выбранное предложение
                                suggestions.style.display = 'none'; // Скрыть предложения
                                errorSelect.value = key; // Установить значение выбора
                                errorSelect.dispatchEvent(new Event('change')); // Запустить событие изменения
                            };
                            suggestions.appendChild(suggestionItem);
                        });
                    } else {
                        suggestions.style.display = 'none'; // Скрыть предложения, если нет совпадений
                    }
                } else {
                    suggestions.style.display = 'none'; // Скрыть предложения, если ввод пуст
                }
            });

            fetchErrors(); // Первоначальный запрос для получения ошибок
        });
    </script>


<script src="/static/script.js"></script>
</body>
</html>
